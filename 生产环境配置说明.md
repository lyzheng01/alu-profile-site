# 生产环境配置说明

## 问题描述
产品页面的图片地址显示为开发环境地址：`@http://127.0.0.1:9001/media/products/...`

## 解决方案

### 方案一：设置环境变量（推荐）

#### 1. 创建环境变量文件

在 `/www/wwwroot/Aluminum/frontend/` 目录下创建 `.env.production` 文件：

```bash
# 生产环境配置
REACT_APP_API_URL=https://your-domain.com
```

请将 `your-domain.com` 替换为您的实际域名。

#### 2. 重新构建前端

```bash
cd /www/wwwroot/Aluminum/frontend
npm run build
```

### 方案二：直接修改配置文件（已自动完成）

我已经修改了 `frontend/src/config/api.ts` 文件，现在您只需要：

1. **修改域名配置**：
   在 `frontend/src/config/api.ts` 文件的第3行，将 `your-domain.com` 替换为您的实际域名：
   ```typescript
   const PRODUCTION_DOMAIN = 'https://your-actual-domain.com'; // 替换为您的实际域名
   ```

2. **重新构建前端**：
   ```bash
   cd /www/wwwroot/Aluminum/frontend
   npm run build
   ```

### 方案三：使用调试组件

如果问题仍然存在，可以在产品页面临时添加调试组件：

1. 在 `frontend/src/pages/Products.tsx` 中导入调试组件：
   ```typescript
   import UrlDebugger from '../components/UrlDebugger';
   ```

2. 在页面中临时添加调试组件：
   ```jsx
   <UrlDebugger />
   ```

3. 查看调试信息，确认URL解析是否正确。

### 3. 确保Django媒体文件配置正确

检查 `/www/wwwroot/Aluminum/backend/aluminum/settings.py` 中的配置：

```python
MEDIA_URL = '/media/'
MEDIA_ROOT = BASE_DIR / 'media'
```

### 4. 确保Nginx配置正确

在Nginx配置中添加媒体文件处理：

```nginx
location /media/ {
    alias /www/wwwroot/Aluminum/backend/media/;
    expires 30d;
    add_header Cache-Control "public, immutable";
}
```

### 5. 验证配置

访问以下URL确认媒体文件可以正常访问：
- `https://your-domain.com/media/products/your-image.png`

## 调试方法

### 1. 检查当前配置

在浏览器控制台中运行：

```javascript
console.log('API_BASE_URL:', window.location.origin);
console.log('当前页面:', window.location.href);
```

### 2. 测试URL解析

在浏览器控制台中运行：

```javascript
// 测试URL解析函数
function testUrl(url) {
  console.log('原始URL:', url);
  // 这里需要导入resolveMediaUrl函数进行测试
}
```

### 3. 检查网络请求

在浏览器开发者工具的Network标签中，查看图片请求的URL是否正确。

## 常见问题

### Q: 图片仍然显示开发环境地址
A: 确保已经重新构建前端，并且清除了浏览器缓存。

### Q: 图片无法加载
A: 检查Nginx配置是否正确，确保媒体文件路径存在。

### Q: 环境变量不生效
A: 确保环境变量文件在正确的位置，并且重新构建了前端。

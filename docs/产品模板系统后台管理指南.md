# 产品模板系统后台管理指南

## 概述

产品模板系统现在支持在后台管理界面中编辑和管理。可以为不同的分类/子分类创建多个模板，产品会自动匹配并使用对应的模板数据。

## 功能特点

✅ **后台可视化管理**：通过Django Admin界面管理模板  
✅ **多模板支持**：不同分类可以有不同的模板  
✅ **自动匹配**：产品根据分类/子分类自动匹配模板  
✅ **结构化数据**：支持规格、特性、应用场景、工厂图片等  
✅ **灵活覆盖**：产品自定义数据优先级高于模板数据  

## 访问模板管理

1. 登录Django后台管理：`http://你的域名/admin/`
2. 在左侧菜单找到 **"产品模板"**
3. 可以查看、创建、编辑、删除模板

## 创建模板步骤

### 步骤1：创建模板基本信息

1. 点击 **"添加产品模板"**
2. 填写基本信息：
   - **模板名称**：例如 "T-Slot铝型材模板"
   - **关联分类**：选择此模板适用的分类（可选）
   - **关联子分类**：选择此模板适用的子分类（可选）
     - ⚠️ 子分类优先级高于分类
     - 如果同时设置了分类和子分类，只有子分类的产品会使用此模板
   - **是否激活**：勾选表示启用
   - **排序**：数字越小越靠前

### 步骤2：填写基础参数

- **Range**：规格范围
- **Type**：产品类型
- **Surface Treatment**：表面处理
- **Colors**：颜色
- **Grade**：等级
- **Temper**：回火状态

### 步骤3：填写描述和内容

- **产品描述**：通用产品描述
- **特性文本**：产品特性（文本格式）
- **应用文本**：应用领域（文本格式）
- **规格文本**：技术规格（文本格式）
- **包装详情**：包装信息

### 步骤4：填写商业信息

- **支持OEM**：是否支持OEM
- **免费样品**：样品信息
- **供应能力**：每月供应量
- **付款方式**：付款条件
- **产品产地**：生产地
- **发货港口**：发货港口
- **交期**：交货时间

### 步骤5：添加结构化数据（重要）

在页面下方的内联编辑区域添加：

#### 模板技术规格
点击 **"添加另一个模板技术规格"**，添加多行规格：
- 规格名称：如 "Material & Temper"
- 规格值：如 "6063-T5, 6061-T6"
- 排序：数字越小越靠前

#### 模板特性
点击 **"添加另一个模板特性"**：
- 特性名称
- 特性描述
- 排序

#### 模板应用领域
点击 **"添加另一个模板应用领域"**：
- 应用名称
- 应用描述
- **应用场景图片**（可选）：上传图片
- 排序

#### 模板工厂图片
点击 **"添加另一个模板工厂图片"**：
- 图片标题：如 "Factory Scene"
- 图片描述
- **工厂图片**：上传图片
- 图片分类：如 "factory", "production", "quality", "packaging"
- 排序

### 步骤6：保存模板

点击 **"保存"**，模板创建完成。

## 模板匹配规则

系统按以下优先级自动匹配模板：

1. **子分类模板**：如果产品有子分类，且该子分类有模板 → 使用子分类模板
2. **分类模板**：如果产品的分类有模板 → 使用分类模板
3. **无模板**：如果没有匹配的模板，产品使用自己的数据

## 使用示例

### 示例1：为T-Slot型材创建模板

1. **创建模板**：
   - 名称：T-Slot铝型材模板
   - 关联分类：工业铝型材
   - 关联子分类：T-Slot铝型材（如果有子分类）

2. **填写通用信息**：
   - Range: OEM factory supply aluminium profiles
   - Type: T-Slot V-Slot Aluminium Profile
   - Surface Treatment: Anodized, Powder Coated
   - ...

3. **添加规格项**（19项）：
   - Material & Temper: 6063-T5, 6061-T6
   - Surface Treatment: Anodized, Powder Coated...
   - ...

4. **添加应用场景**（6项）：
   - Factory assembly line
   - Workstations and test stations
   - ...

5. **添加工厂图片**（4张）：
   - Factory Scene
   - Production Process
   - Quality Check
   - Packing

### 示例2：为门窗型材创建模板

类似步骤，但：
- 关联分类：建筑铝型材
- 关联子分类：门窗型材
- 规格和应用场景可以不同

## 产品如何使用模板

### 自动应用

产品访问详情页时，系统会自动：
1. 根据产品的分类/子分类查找匹配的模板
2. 如果找到模板，将模板数据合并到产品数据
3. 产品自定义数据优先级高于模板数据

### 数据优先级

- **产品有值**：使用产品自定义值
- **产品无值，模板有值**：使用模板值
- **都无值**：显示空

### 查看效果

访问产品详情页（前端），会自动显示：
- 合并后的规格表格
- 模板的应用场景
- 模板的工厂图片
- 模板的商业信息

## 管理多个模板

### 场景1：不同分类有不同模板

```
分类A → 模板A
分类B → 模板B
```

### 场景2：同一分类不同子分类有不同模板

```
分类A
  ├─ 子分类A1 → 模板A1
  └─ 子分类A2 → 模板A2
```

### 场景3：分类模板 + 子分类模板（子分类优先）

```
分类A → 模板A（默认）
  └─ 子分类A1 → 模板A1（优先使用）
```

## API接口

### 获取所有模板

```
GET /api/product-templates/
```

### 获取特定分类的模板

```
GET /api/product-templates/?category=1
GET /api/product-templates/?subcategory=1
```

### 获取模板详情

```
GET /api/product-templates/{id}/
```

### 产品详情API（自动合并模板）

```
GET /api/products/{id}/
```

返回的产品数据已经包含了合并后的模板数据。

## 注意事项

⚠️ **模板优先级**：
- 子分类模板 > 分类模板
- 如果产品有子分类，只会匹配子分类模板

⚠️ **激活状态**：
- 只有激活的模板（`is_active=True`）才会被使用
- 可以临时禁用模板而不删除

⚠️ **数据更新**：
- 修改模板后，所有使用该模板的产品会自动更新
- 不需要单独更新每个产品

⚠️ **图片上传**：
- 应用场景图片和工厂图片需要上传到服务器
- 图片路径会自动转换为URL

## 常见问题

### Q: 如何查看哪些产品使用了某个模板？
A: 在后台查看该分类/子分类下的所有产品，它们都会使用对应的模板。

### Q: 产品可以覆盖模板的某些字段吗？
A: 可以。如果产品有自定义值，会优先使用产品值。

### Q: 如何禁用某个模板？
A: 在模板编辑页面，取消勾选"是否激活"，保存即可。

### Q: 可以为一个分类创建多个模板吗？
A: 技术上可以，但系统只会使用排序最靠前的激活模板。

## 下一步

1. ✅ 创建数据库迁移：`python manage.py migrate`
2. ✅ 在后台创建模板
3. ✅ 测试产品详情页显示
4. ✅ 根据实际需要调整模板内容


# å›¾ç‰‡æ˜¾ç¤ºé—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜åˆ†æ

ç»è¿‡æ£€æŸ¥ï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š

1. **âœ… Djangoé…ç½®å·²ä¿®å¤**ï¼š
   - å·²è®¾ç½® `DEBUG = False`
   - å·²é…ç½®ç”Ÿäº§ç¯å¢ƒ `MEDIA_URL = 'http://lingyealu.cn/media/'`
   - APIç°åœ¨è¿”å›æ­£ç¡®çš„å›¾ç‰‡URLï¼š`http://lingyealu.cn/media/products/...`

2. **âŒ Nginxé…ç½®é—®é¢˜**ï¼š
   - Nginxé…ç½®æ–‡ä»¶æœ‰è¯­æ³•é”™è¯¯
   - ç¼ºå°‘åª’ä½“æ–‡ä»¶è·¯å¾„é…ç½®
   - åª’ä½“æ–‡ä»¶è¿”å›404é”™è¯¯

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤1: ä¿®å¤Nginxé…ç½®

æ‚¨éœ€è¦åœ¨Nginxé…ç½®ä¸­æ·»åŠ åª’ä½“æ–‡ä»¶è·¯å¾„é…ç½®ã€‚è¯·å°†ä»¥ä¸‹é…ç½®æ·»åŠ åˆ°æ‚¨çš„ç½‘ç«™é…ç½®æ–‡ä»¶ä¸­ï¼š

```nginx
# åª’ä½“æ–‡ä»¶é…ç½® - æ·»åŠ åˆ°æ‚¨çš„ç½‘ç«™é…ç½®ä¸­
location /media/ {
    alias /www/wwwroot/Aluminum/backend/media/;
    
    # å¤„ç†ä¸­æ–‡æ–‡ä»¶å
    charset utf-8;
    
    # è®¾ç½®ç¼“å­˜
    expires 30d;
    add_header Cache-Control "public, immutable";
    
    # è®¾ç½®æ­£ç¡®çš„MIMEç±»å‹
    location ~* \.(jpg|jpeg|png|gif|ico|svg)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

### æ­¥éª¤2: ä¿®å¤Nginxè¯­æ³•é”™è¯¯

æ£€æŸ¥å¹¶ä¿®å¤ `/www/server/nginx/conf/nginx.conf` ç¬¬100è¡Œçš„é…ç½®é”™è¯¯ï¼š

```bash
# æ£€æŸ¥Nginxé…ç½®
nginx -t

# å¦‚æœä»æœ‰é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç¬¬100è¡Œé™„è¿‘çš„é…ç½®
```

### æ­¥éª¤3: é‡å¯æœåŠ¡

```bash
# é‡å¯Nginx
systemctl restart nginx

# é‡å¯DjangoæœåŠ¡ï¼ˆå¦‚æœä½¿ç”¨systemdï¼‰
systemctl restart your-django-service

# æˆ–è€…å¦‚æœä½¿ç”¨å…¶ä»–æ–¹å¼è¿è¡ŒDjango
# è¯·é‡å¯æ‚¨çš„Djangoè¿›ç¨‹
```

### æ­¥éª¤4: éªŒè¯ä¿®å¤

```bash
# æµ‹è¯•åª’ä½“æ–‡ä»¶è®¿é—®
curl -I "http://lingyealu.cn/media/products/å¾®ä¿¡å›¾ç‰‡_20250914155329.png"

# åº”è¯¥è¿”å› 200 OK è€Œä¸æ˜¯ 404
```

## ğŸ“‹ å®Œæ•´çš„Nginxé…ç½®ç¤ºä¾‹

```nginx
server {
    listen 80;
    server_name lingyealu.cn www.lingyealu.cn;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /www/wwwroot/Aluminum/frontend/build;
        try_files $uri $uri/ /index.html;
    }
    
    # åç«¯API
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # åª’ä½“æ–‡ä»¶ - å…³é”®é…ç½®
    location /media/ {
        alias /www/wwwroot/Aluminum/backend/media/;
        charset utf-8;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
    
    # é™æ€æ–‡ä»¶
    location /static/ {
        alias /www/wwwroot/Aluminum/backend/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

## âœ… éªŒè¯æ­¥éª¤

1. **æ£€æŸ¥APIè¿”å›**ï¼š
   ```bash
   curl -s http://lingyealu.cn/api/products/7/ | grep -o '"image":"[^"]*"'
   ```
   åº”è¯¥æ˜¾ç¤ºï¼š`"image":"http://lingyealu.cn/media/products/..."`

2. **æ£€æŸ¥å›¾ç‰‡è®¿é—®**ï¼š
   ```bash
   curl -I "http://lingyealu.cn/media/products/å¾®ä¿¡å›¾ç‰‡_20250914155329.png"
   ```
   åº”è¯¥è¿”å›ï¼š`HTTP/1.1 200 OK`

3. **æµè§ˆå™¨æµ‹è¯•**ï¼š
   è®¿é—® `http://lingyealu.cn/zh/products/7` æŸ¥çœ‹å›¾ç‰‡æ˜¯å¦æ­£å¸¸æ˜¾ç¤º

## ğŸš¨ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

1. **æ£€æŸ¥Nginxé”™è¯¯æ—¥å¿—**ï¼š
   ```bash
   tail -f /var/log/nginx/error.log
   ```

2. **æ£€æŸ¥æ–‡ä»¶æƒé™**ï¼š
   ```bash
   ls -la /www/wwwroot/Aluminum/backend/media/products/
   ```

3. **æ£€æŸ¥Nginxé…ç½®**ï¼š
   ```bash
   nginx -t
   ```

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥éª¤æ“ä½œåé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ï¼š
1. Nginxé”™è¯¯æ—¥å¿—å†…å®¹
2. å½“å‰çš„Nginxé…ç½®æ–‡ä»¶å†…å®¹
3. å…·ä½“çš„é”™è¯¯ç°è±¡æè¿°
